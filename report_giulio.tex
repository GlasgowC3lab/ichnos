\documentclass{article}
\usepackage{listings}
\usepackage{hyperref}
\begin{document}
\section{Report}

This document is to provide an overview of the features of water and land use footprints as contributions to the Ichnos project.
\paragraph{Energy Intensity factors, WUE, and LUE}
Firstly, let us define water and land footprints. Both footprints can be broken down into two components: the onsite and offsite footprint. The onsite footprint is the water or land use associated with the operation of the data center, while the offsite footprint is the water or land use associated with the generation of the electricity used by the data center.
The onsite water use effectiveness (WUE) is defined as the amount of water used by the data center per unit of energy consumed, typically expressed in liters per kilowatt-hour (L/kWh). 
The offsite water use intensity factor (EWIF) is defined as the amount of water used in the generation of electricity per unit of energy produced, typically expressed in liters per kilowatt-hour (L/kWh). This value is dependent on the energy mix of the electricity grid supplying the data center.
Similarly, we define the onsite land use effectiveness (LUE) as the amount of land used by the data center per unit of energy consumed, expressed in square meters per kilowatt-hour (m²/kWh).
The offsite land use intensity factor (ELIF) is defined as the amount of land used in the generation of electricity per unit of energy produced, typically expressed in square meters per kilowatt-hour (m²/kWh). This value is also dependent on the energy mix of the electricity grid supplying the data center.

WUE and LUE can be obtained from the data center operator or estimated, while EWIF and ELIF can be obtained from the energy mix of the electricity grid supplying the data center.

For this project, we consider WUE and LUE as input parameters that can be provided by the user. On the other hand, EWIF and ELIF can be computed with our model starting from the energy mix of the electricity grid supplying the data center.
Using ichnos, it is possible to:
\begin{itemize}
    \item download the energy mix of a specific region and time period from different external APIs (e.g., Electricity Maps, NESO). We consider the following sources for the energy mix: wind, solar, hydro, geothermal, biomass, nuclear, coal, gas, oil, and unknown.
    Note that not all APIs provide the same level of detail in the energy mix data. Here are the differences between Electricity maps and NESO:
    \begin{itemize}
        \item Electricity Maps provides data on the energy mix of a specific region. The granularity of the data is 1 hour. It is possible to access the last hour, the last 24 hours. Respectively, from \verb|src.external_apis.energy_mix.electricity_maps| the functions \verb|get_energy_mix_last|, and \verb|get_energy_mix_pt2|4.
        We consider the "powerConsumptionBreakdown" field of the output received by electricity maps APIs and we count "hydro discharge", "battery discharge", and "unknown" fields as "unknown" source. Also, data from Electricity Maps is provided in MW; thus, we compute the percentages in 0-1 to represent the mix as sources' shares.
        \item NESO provides data on the UK energy mix. The granularity of the data is 30 minutes. It is possible to access the last half hour, the 24 hours previous to a given timestamp, or a specific range of time. Respectively, from \verb|src.external_apis.energy_mix.neso| the functions \verb|get_energy_mix_last|, \verb|get_energy_mix_pt24|, and \verb|get_energy_mix|. NESO api provides data in percentage in 0-100\%; thus, we normalize them in 0-1, and we count the "other" field as "unknown" source.
    \end{itemize}
    \item compute the EWIF and ELIF from the energy mix data using the source intensity factors provided in \verb|src.external_apis.energy_mix.energy_mix_record| (dataclass WaterIntensityFactors and dataclass LandUseIntensityFactors). Intensity factors are taken from the following sources:
    \begin{itemize}
        \item Water intensity factors are taken from \href{https://www.nrel.gov/docs/fy11osti/50900.pdf}{nrel.gov} considering the median column from table 1 and 2 (water consumption). When multiple values are provided for a source due to technology differences, we take the mean value.
        \item Land use intensity factors are taken from \href{https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0270155.}{this survey}. Note that this survey does not provide a ELIF value for oil, but the authors assume it to be comparable to gas.
    \end{itemize}
\end{itemize}
Refer to the code in \verb|src.external_apis.energy_mix.interface| to see how to use the different APIs to download the energy mix data and compute the EWIF and ELIF.

Output files are automatically saved in data/intensity folder. The user can provide a custom suffix for the names of the files, otherwise, the default suffix is "", and the files will be named "ewif" and "elif" for water and land use intensity factors, respectively. By default, only ewif and elif will be computed and stored, but it is possible to store also the energy mix data by providing "mix" in the list passed as parameter "factors". The same applies to the carbon intensity, including "ci" in such list.

\paragraph{Footprints calculation}
Finally, the water and land use footprints are computed in \verb|src.scripts.OperationalCarbon|, where the water and land use footprints are added to the OperationalCarbonReport class. The water and land use footprints are computed for each task and then summed up to obtain the total water and land use footprints for the entire job. 
For each task, the water and land use footprints are computed as follows:
\begin{itemize}
    \item \verb|Onsite footprint = (energy_core_pue + energy_mem_pue) * WUE (water) or LUE (land)|
    \item \verb|Offsite footprint = (energy_core + energy_mem) * EWIF (water) or ELIF (land)|
    \item \verb|Total footprint = Onsite footprint + Offsite footprint|
\end{itemize}

To enable the computation of water and land use footprints, the user needs to provide WUE and/or LUE as input parameters. If WUE is provided, EWIF file name/value must be provided as well, so that the water footprint will be computed. If LUE is provided, ELIF file name/value must be provided as well, so that the land use footprint will be computed. 



\paragraph{How to run a test}
\begin{enumerate}
    \item Download the intensity factors\\ 
    \verb|python -m src.external_apis.energy_mix.interface --api neso --mode range|\\\verb| --from_time 2023-11-15T00:00Z --to_time 2023-12-08T23:00Z |\\\verb| --output_suffix test_ --factors ci ewif elif|\\
    \item Run IchnosCF with the following command:\\
    \verb|python -m src.scripts.IchnosCF -c "data/ichnos_config/water_land_config.yaml"|
    \\
    \verb|data/ichnos_config/water_land_config.yaml| can be edited to change input parameters.
\end{enumerate}

\end{document}